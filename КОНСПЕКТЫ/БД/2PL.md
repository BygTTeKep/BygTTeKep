Двухфазная блокировка - это классический протокол управления конкурентным доступом в СУБД, которая гарантирует сериализуемость транзакций.
## Идея
Каждая транзакция должна проходить 2 фазы
- фаза роста(growing phase) - транзакия только захватывает блокировки
- фаза сокращения(shrinking phase) - Транзакция только освобождает блокировки
! После того как транзакция освободила хотябы одну блокировку, она уже не модет захватывать новые
Это правило и гарантирует сериализуемость.

---
## Основные виды блокировок

| shared    | s   | чтение |
| --------- | --- | ------ |
| exclusive | x   | запись |
## Почему 2pl обеспечивает serializable
2pl гарантирует что граф сериализаций будет ацикличен
- любое расписание построенное по 2pl конфлитно сериализуемо
- значит эквивалентно некоторому последовательному выполнению транзаций
---
## Виды 2PL
### Basic
Правила:
- Создается фаза роста и сокращения
- Блокировки можно освоблодить до commit
Плюсы:
- Гарантирует сериализуемость
Минусы:
- Возможны грязные чтения
- Возможны deadlock'и
---
### Strict 2PL
самая популярная
Доп правило:
- Все x блокировки удерживаются до commit/rollback
Гарантии:
- Нет грязных чтений
- serialazible
- Нет каскадных откатов
Минусы:
- Возможны deadlock'и
### Rigorous 2PL(жесткая)
Правило:
- И S и X блокировки удирживаются до commit/rollback
Свойство:
- Расписания не только сериализуемо, но и строго сериализуемо
---
### Conservative 2PL
Правило:
- транзакция захватывает все необходимые блокировки заранее, если не удалось не стартует
Плюсы:
- deadlock'и не  возможны
Минусы:
- Нужно знать все ресурсы заранее. Сильно снижает параллелизм
---

На уровне изоляции serializable обычно используют;
- Strict 2PL
- SSI
Чтобы избежаеть phantom read используют:
- Range locks
- Predicate locks
- Indexes locks