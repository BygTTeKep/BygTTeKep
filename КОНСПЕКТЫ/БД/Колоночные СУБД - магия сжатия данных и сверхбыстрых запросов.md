[ссылка](https://highload.ru/genesis/2025/abstracts/16249)

Что помогает субд трактовать последовательность байт
Модель данных - Это набор понятий для описания
- Структуры хранимых данных
- Типов взоимосвязей между данными
Схема данных - это описание конкретной коллекции данных с использованием заданной модели.
Какие бывают субд
1) key/value
2) Графовые
3) Документные
4) Векторные
5) Реляционные
Реляционная модель предоставляет логическую абстракцию юазы данных, основанную на простых структурах данных, называемых отношениями

Отношения - это множества, содержащее взаимосвязи атрибутов, представляющих сущности.
Кортеж - это набор скалярных значений атрибутов в отношении.
**Типы нагрузок**
1) OLTP(WRITE HEAVY ЗАПРОСЫ)
2) OLAP(READ HEAVY ЗАПРОСЫ)
3) HTAB
## storage model
Модель хранения данных CУБД определяет, как она физически организует кортежи на диске и в памяти.
- Может иметь разные характеристики производительности в зависимости от целевой рабочей нагрузки
- Влияет на выбор дизайна остальной части СУБД
## Модели
Disk-based- системы
![[Pasted image 20251005141338.png]]
Реляционная таблица - несколько файлов которые разбиты на страницы(в среднем 4kb)
### N-ary storage model(NSM)
(Мы берем и просто записываем каждую строчку последовательно в рамках страницы)
СУБД хранит(почти) все атрибуты для одного кортежа последователь на  одной странице. или Row State.
- Идеально подходит для рабочих нагрузок OLTP, где запросы с большей вероятностью обращаются к отдельным объектам и выполнябт рабочие нагрузки с большими объемами записи
![[Pasted image 20251005142021.png]]что будет при таком запросе
сначало достаются все hostname чтобы провести фильтрацию, потом все логины, остальные данные будут бесполезно загружены в память.
Преимущества:
- Быстрая вставка, обновление и удаление
- Подходит для запросов, которым требуется весь кортеж (OLTP)
Недостатки:
- не подходит для сканирования больших частей таблицы и/или подмножества атрибутов;
- плохая локальность памяти при паттернах доступа
### Decomposition Storage Model (DSM)
Хранит отдельные атрибуты для всех котежей последовательно в блоке данных.
Также известна как column store.

Идеально подходит для OLAP-нагрузок, где преимущественно чтения выполняют масштабное сканирование поджества атрибутов таблицы.

СУБД отвечает за объединение/разбение атрибутов кортежи при чтении/записи
![[Pasted image 20251005143017.png]]каждая страница будет отвечать за хранение какогото конкретного атрибута
![[Pasted image 20251005143109.png]]
Вычитает страничку где хранятся все hostname(cache friednly т.к. будем обращаться последовательно к каждому элементу массива)
Затем зная индексы кортежей которые нам нужны, мы просто вычитаем следующую страничку с логинами и получим необходимые логины

Преимущества
- уменьшает количество ненужных I/O операций на запрос, поскольку СУБД читает только те данные, которые ей нужны;
- ускоряет обработку запросов благодаря большей локальности и повторному использованию кэшировванных данных.
Недостатки
- Медленно выполняет точечные запросы, вставки, обновления и удаления из-за разделения/сшивания/реорганизацию кортежей
## Проблемы
- NSM - неэффективен для аналитики из-за чтения всех колонок разом
- DSM - неэффективен для точечных запросов, т.к. для сборки одной строки нужно много I/O операций
### Partition Attributes Across(PAX)
Это гибридная модель хранения, которая вертикально партиционирует атрибуты в рамках страницы бд.
- Примеры: Parquet, ORC, Arrow
Цель состоит в том чтобы ускорить обработку поверх columnar store, сохранив при этом преимущества пространственной локальности row store. 

PAX: физическая организация
- Горизонтально партиционируем данные в row groups
- Вертикально партиционируем их атрибуты в column chunks
Отличие от dsm тут данные хранятся в рамках одной страницы и партиционированно, в dsm данные разбиты по страницам
PAX
![[Pasted image 20251005145244.png]]dsm
![[Pasted image 20251005145258.png]]Наблюдения
- I/O является основным узким местом  disk-based-систем
## Сжатие данных
СУБД может сжимать страницы, чтобы повысить полезность данных, пемещаемых за I/O операцию
Ключевым компромисом является CPU vs Compression Ratio.
### Run-Length Encoding
Сжатие Последовательности одинаковых значений атрибута в тройки:
- значение атрибута
- стартовая позиция в сегменте колонки
- количество элементов последовательности
Для оптимального сжатия требуется, чтобы колонка была отсортирована.
![[Pasted image 20251005150154.png]]
### Bit packing
Если занчения целочисленного атрибута меньше, чем диапазон для заданного типа, тогда можно уменьшить количество битов для представления этих значений
![[Pasted image 20251005150329.png]]
### Delta encoding
Записываем разницу между последовательными значениями в одной колонке.
Первое значение можно хранить явно либо отдельно в метаданных.
![[Pasted image 20251005150451.png]]
### Dictionary encoding
Заменим часто встречающиеся значения кодами фиксированной длины меньшего размера, а затем сохраним отображение(словарь) этих кодов в исходные значения.
- Как правило один код на значение атрибута
- Наиболее широко исподльзуемая нативная схема сжатия в СУБД
Идеальная схема словаря поддерживает быстрое кодирование и декодирование как для точечных, так и для range-запросов
![[Pasted image 20251005150930.png]]
## Data skipping(для высокой селективности)
Используем подходы
- min/max статистики
- bloom filters(функции на странице для определения что есть данные подходящие)
- sparse indexes(in memory)
## Execution Engine
![[Pasted image 20251005151904.png]]
### Single Instruiction, multimple data(SIMD)
Параллелизм уровня данных
![[Pasted image 20251005152440.png]]
### Vectorized engine
![[Pasted image 20251005152523.png]]

просто для примера 
![[Pasted image 20251005154105.png]]

![[Pasted image 20251005154401.png]]